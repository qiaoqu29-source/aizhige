<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIèŠå¤©æ‰‹æœº</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .phone {
            width: 375px;
            height: 812px;
            background: #000;
            border-radius: 40px;
            padding: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            position: relative;
        }

        .phone-screen {
            width: 100%;
            height: 100%;
            background: #fff;
            border-radius: 30px;
            overflow: hidden;
            position: relative;
        }

        /* æ¡Œé¢æ ·å¼ */
        .desktop {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .status-bar {
            color: #333;
            font-size: 32px;
            font-weight: bold;
            text-align: center;
            padding: 30px 0;
        }

        .clock {
            font-size: 72px;
            font-weight: 200;
            margin-bottom: 10px;
        }

        .date {
            font-size: 18px;
            font-weight: normal;
            opacity: 0.8;
        }

        .app-grid {
            flex: 1;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(4, auto);
            gap: 30px;
            align-content: start;
            padding-top: 50px;
            position: relative;
        }

        .app-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .app-icon:active {
            transform: scale(0.9);
        }

        .icon {
            width: 70px;
            height: 70px;
            border-radius: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            margin-bottom: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .icon.settings {
            background: linear-gradient(135deg, #868f96 0%, #596164 100%);
        }

        .app-name {
            font-size: 12px;
            color: #333;
            text-align: center;
        }

        .settings-icon-position {
            position: absolute;
            bottom: 0;
            left: 0;
        }

        /* é¡µé¢å®¹å™¨ */
        .page {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            background: #fff;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
            z-index: 10;
        }

        .page.active {
            transform: translateX(0);
        }

        /* å¯¼èˆªæ  */
        .nav-bar {
            background: #f8f8f8;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #ddd;
            min-height: 60px;
        }

        .back-btn, .add-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
        }

        .nav-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        /* èŠå¤©åˆ—è¡¨ */
        .chat-list {
            flex: 1;
            overflow-y: auto;
            background: #fff;
        }

        .character-item {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: background 0.2s;
        }

        .character-item:active {
            background: #f5f5f5;
        }

        .character-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            margin-right: 15px;
        }

        .character-info {
            flex: 1;
        }

        .character-name {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .character-preview {
            font-size: 13px;
            color: #999;
        }

        /* èŠå¤©ç•Œé¢ */
        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f0f0f0;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-end;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-bubble {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            word-wrap: break-word;
        }

        .message.ai .message-bubble {
            background: white;
            color: #333;
            border-bottom-left-radius: 4px;
        }

        .message.user .message-bubble {
            background: #667eea;
            color: white;
            border-bottom-right-radius: 4px;
        }

        /* è¾“å…¥åŒºåŸŸ */
        .input-area {
            background: #fff;
            padding: 12px;
            display: flex;
            gap: 8px;
            border-top: 1px solid #ddd;
        }

        .message-input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 14px;
            outline: none;
        }

        .send-btn, .ai-reply-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            white-space: nowrap;
        }

        .ai-reply-btn {
            background: #52c41a;
        }

        /* è®¾ç½®é¡µé¢ */
        .settings-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .setting-item {
            margin-bottom: 25px;
        }

        .setting-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
            display: block;
        }

        .setting-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        .save-btn {
            width: 100%;
            background: #667eea;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
        }

        /* æ¨¡æ€æ¡† - å…³é”®ä¿®å¤ */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
        }

        .modal-overlay.show {
            display: table;
        }

        .modal-wrapper {
            display: table-cell;
            vertical-align: middle;
            text-align: center;
            padding: 20px;
        }

        .modal-content {
            display: inline-block;
            background: white;
            padding: 25px;
            border-radius: 16px;
            width: 90%;
            max-width: 320px;
            text-align: left;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
        }

        .modal-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 14px;
            display: block;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-btn {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }

        .modal-btn-cancel {
            background: #eee;
            color: #333;
        }

        .modal-btn-confirm {
            background: #667eea;
            color: white;
        }
    </style>
</head>
<body>
    <div class="phone">
        <div class="phone-screen">
            <!-- æ¡Œé¢ -->
            <div class="desktop" id="desktop">
                <div class="status-bar">
                    <div class="clock" id="clock">12:00</div>
                    <div class="date" id="date">1æœˆ1æ—¥ æ˜ŸæœŸä¸€</div>
                </div>
                <div class="app-grid">
                    <div class="app-icon" onclick="openPage('chat-list-page')">
                        <div class="icon">ğŸ’¬</div>
                        <div class="app-name">èŠå¤©</div>
                    </div>
                    <div class="app-icon settings-icon-position" onclick="openPage('settings-page')">
                        <div class="icon settings">âš™ï¸</div>
                        <div class="app-name">è®¾ç½®</div>
                    </div>
                </div>
            </div>

            <!-- èŠå¤©åˆ—è¡¨é¡µ -->
            <div class="page" id="chat-list-page">
                <div class="nav-bar">
                    <button class="back-btn" onclick="closePage('chat-list-page')">è¿”å›</button>
                    <div class="nav-title">èŠå¤©</div>
                    <button class="add-btn" onclick="showModal()">åˆ›å»ºè§’è‰²</button>
                </div>
                <div class="chat-list" id="character-list"></div>
            </div>

            <!-- èŠå¤©ç•Œé¢ -->
            <div class="page" id="chat-page">
                <div class="nav-bar">
                    <button class="back-btn" onclick="backToCharacterList()">è¿”å›</button>
                    <div class="nav-title" id="current-character-name">è§’è‰²å</div>
                    <div></div>
                </div>
                <div class="chat-container" id="chat-container"></div>
                <div class="input-area">
                    <input type="text" class="message-input" id="message-input" placeholder="è¾“å…¥æ¶ˆæ¯..." onkeypress="handleEnter(event)">
                    <button class="send-btn" onclick="sendMessage()">å‘é€</button>
                    <button class="ai-reply-btn" onclick="getAIReply()">AIå›å¤</button>
                </div>
            </div>

            <!-- è®¾ç½®é¡µ -->
            <div class="page" id="settings-page">
                <div class="nav-bar">
                    <button class="back-btn" onclick="closePage('settings-page')">è¿”å›</button>
                    <div class="nav-title">è®¾ç½®</div>
                    <div></div>
                </div>
                <div class="settings-container">
                    <div class="setting-item">
                        <label class="setting-label">APIåœ°å€</label>
                        <input type="text" class="setting-input" id="api-url" placeholder="https://api.example.com/chat">
                    </div>
                    <div class="setting-item">
                        <label class="setting-label">APIå¯†é’¥</label>
                        <input type="password" class="setting-input" id="api-key" placeholder="è¾“å…¥ä½ çš„APIå¯†é’¥">
                    </div>
                    <div class="setting-item">
                        <label class="setting-label">æ¨¡å‹åç§°</label>
                        <input type="text" class="setting-input" id="model-name" placeholder="gpt-3.5-turbo">
                    </div>
                    <button class="save-btn" onclick="saveSettings()">ä¿å­˜è®¾ç½®</button>
                </div>
            </div>
        </div>
    </div>

    <!-- åˆ›å»ºè§’è‰²æ¨¡æ€æ¡† - ä¿®å¤äº‹ä»¶å†’æ³¡ -->
    <div class="modal-overlay" id="modal">
        <div class="modal-wrapper" onclick="event.stopPropagation()">
            <div class="modal-content" onclick="event.stopPropagation()">
                <div class="modal-title">åˆ›å»ºæ–°è§’è‰²</div>
                <input type="text" class="modal-input" id="modal-name" placeholder="è§’è‰²åç§°" onclick="event.stopPropagation()">
                <textarea class="modal-input" id="modal-prompt" placeholder="è§’è‰²è®¾å®š" style="height: 100px; resize: vertical;" onclick="event.stopPropagation()"></textarea>
                <div class="modal-buttons">
                    <button class="modal-btn modal-btn-cancel" id="btn-cancel">å–æ¶ˆ</button>
                    <button class="modal-btn modal-btn-confirm" id="btn-confirm">åˆ›å»º</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ•°æ®
        let characters = [];
        let currentCharacter = null;
        let settings = {
            apiUrl: '',
            apiKey: '',
            modelName: 'gpt-3.5-turbo'
        };

        // åˆå§‹åŒ–å‡½æ•°
        function init() {
            // åŠ è½½æ•°æ®
            characters = JSON.parse(localStorage.getItem('characters') || '[]');
            settings = JSON.parse(localStorage.getItem('settings') || '{"apiUrl":"","apiKey":"","modelName":"gpt-3.5-turbo"}');
            
            updateClock();
            setInterval(updateClock, 1000);
            loadSettings();
            renderCharacterList();
            
            // ç»‘å®šæ¨¡æ€æ¡†æŒ‰é’® - é˜»æ­¢äº‹ä»¶å†’æ³¡
            const cancelBtn = document.getElementById('btn-cancel');
            const confirmBtn = document.getElementById('btn-confirm');
            
            cancelBtn.onclick = function(e) {
                e.stopPropagation();
                hideModal();
            };
            
            confirmBtn.onclick = function(e) {
                e.stopPropagation();
                doCreate();
            };
        }

        function updateClock() {
            const now = new Date();
            document.getElementById('clock').textContent = 
                String(now.getHours()).padStart(2, '0') + ':' + String(now.getMinutes()).padStart(2, '0');
            const days = ['æ˜ŸæœŸæ—¥', 'æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­'];
            document.getElementById('date').textContent = 
                `${now.getMonth() + 1}æœˆ${now.getDate()}æ—¥ ${days[now.getDay()]}`;
        }

        function openPage(pageId) {
            document.getElementById(pageId).classList.add('active');
        }

        function closePage(pageId) {
            document.getElementById(pageId).classList.remove('active');
        }

        // æ¨¡æ€æ¡†
        function showModal() {
            document.getElementById('modal').classList.add('show');
        }

        function hideModal() {
            document.getElementById('modal').classList.remove('show');
            document.getElementById('modal-name').value = '';
            document.getElementById('modal-prompt').value = '';
        }

        function doCreate() {
            const name = document.getElementById('modal-name').value.trim();
            const prompt = document.getElementById('modal-prompt').value.trim();
            
            if (!name) {
                alert('è¯·è¾“å…¥è§’è‰²åç§°');
                return;
            }

            characters.push({
                id: Date.now(),
                name: name,
                prompt: prompt || 'ä½ æ˜¯ä¸€ä¸ªå‹å¥½çš„AIåŠ©æ‰‹ã€‚',
                messages: []
            });

            localStorage.setItem('characters', JSON.stringify(characters));
            renderCharacterList();
            hideModal();
        }

        function renderCharacterList() {
            const list = document.getElementById('character-list');
            if (characters.length === 0) {
                list.innerHTML = '<div style="padding: 40px; text-align: center; color: #999;">æš‚æ— è§’è‰²ï¼Œç‚¹å‡»å³ä¸Šè§’åˆ›å»º</div>';
                return;
            }

            list.innerHTML = '';
            characters.forEach(c => {
                const item = document.createElement('div');
                item.className = 'character-item';
                item.dataset.id = c.id;
                item.onclick = () => openChat(c.id);
                
                const lastMsg = c.messages.length > 0 ? c.messages[c.messages.length - 1].content : 'æš‚æ— æ¶ˆæ¯';
                item.innerHTML = `
                    <div class="character-avatar">${c.name.charAt(0)}</div>
                    <div class="character-info">
                        <div class="character-name">${c.name}</div>
                        <div class="character-preview">${lastMsg.substring(0, 20)}...</div>
                    </div>
                `;
                list.appendChild(item);
            });
        }

        function openChat(characterId) {
            currentCharacter = characters.find(c => c.id === characterId);
            if (!currentCharacter) return;
            document.getElementById('current-character-name').textContent = currentCharacter.name;
            renderMessages();
            closePage('chat-list-page');
            openPage('chat-page');
        }

        function backToCharacterList() {
            closePage('chat-page');
            openPage('chat-list-page');
            currentCharacter = null;
        }

        function renderMessages() {
            const container = document.getElementById('chat-container');
            if (currentCharacter.messages.length === 0) {
                container.innerHTML = '<div style="padding: 40px; text-align: center; color: #999;">å¼€å§‹èŠå¤©å§ï¼</div>';
                return;
            }
            container.innerHTML = currentCharacter.messages.map(msg => `
                <div class="message ${msg.role === 'user' ? 'user' : 'ai'}">
                    <div class="message-bubble">${msg.content}</div>
                </div>
            `).join('');
            container.scrollTop = container.scrollHeight;
        }

        function handleEnter(event) {
            if (event.key === 'Enter') sendMessage();
        }

        function sendMessage() {
            const input = document.getElementById('message-input');
            const content = input.value.trim();
            if (!content || !currentCharacter) return;

            currentCharacter.messages.push({ role: 'user', content: content });
            input.value = '';
            localStorage.setItem('characters', JSON.stringify(characters));
            renderMessages();
        }

        async function getAIReply() {
            if (!currentCharacter) return;
            if (!settings.apiUrl || !settings.apiKey) {
                alert('è¯·å…ˆåœ¨è®¾ç½®ä¸­é…ç½®APIä¿¡æ¯');
                return;
            }

            const messages = [
                { role: 'system', content: currentCharacter.prompt },
                ...currentCharacter.messages
            ];

            try {
                const response = await fetch(settings.apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${settings.apiKey}`
                    },
                    body: JSON.stringify({
                        model: settings.modelName,
                        messages: messages
                    })
                });

                if (!response.ok) throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status}`);

                const data = await response.json();
                currentCharacter.messages.push({
                    role: 'assistant',
                    content: data.choices[0].message.content
                });

                localStorage.setItem('characters', JSON.stringify(characters));
                renderMessages();
            } catch (error) {
                alert('AIå›å¤å¤±è´¥: ' + error.message);
            }
        }

        function loadSettings() {
            document.getElementById('api-url').value = settings.apiUrl;
            document.getElementById('api-key').value = settings.apiKey;
            document.getElementById('model-name').value = settings.modelName;
        }

        function saveSettings() {
            settings = {
                apiUrl: document.getElementById('api-url').value.trim(),
                apiKey: document.getElementById('api-key').value.trim(),
                modelName: document.getElementById('model-name').value.trim() || 'gpt-3.5-turbo'
            };
            localStorage.setItem('settings', JSON.stringify(settings));
            alert('è®¾ç½®å·²ä¿å­˜');
        }

        // ç­‰ DOM åŠ è½½å®Œå†åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>