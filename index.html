<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AI OS Minimal</title>
    <!-- PWA 配置 -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- FontAwesome 图标库 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* === 极简白风格内嵌 CSS (防止加载失败) === */
        :root {
            --bg-base: #F5F5F7;
            --card-white: #FFFFFF;
            --text-main: #000000;
            --text-sub: #86868B;
            --shadow: 0 4px 12px rgba(0,0,0,0.03);
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
            background: var(--bg-base);
            color: var(--text-main);
            height: 100vh; width: 100vw; overflow: hidden;
            -webkit-font-smoothing: antialiased;
        }

        #phone-wrapper { position: relative; width: 100%; height: 100%; overflow: hidden; background: var(--bg-base); }

        /* 状态栏 */
        .status-bar {
            height: calc(24px + var(--safe-top)); padding: var(--safe-top) 24px 0;
            display: flex; justify-content: space-between; align-items: center;
            font-size: 14px; font-weight: 600; color: #000; z-index: 1000; position: relative;
        }
        .battery { width: 22px; height: 11px; border: 1px solid #000; border-radius: 3px; padding: 1px; }
        .battery-level { width: 80%; height: 100%; background: #000; }

        /* 系统通知 */
        .noti-banner {
            position: absolute; top: -100px; left: 16px; right: 16px; height: 70px;
            background: #fff; border-radius: 20px; padding: 16px; display: flex; align-items: center; gap: 14px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.1); z-index: 2000; transition: top 0.5s ease;
        }
        .noti-banner.show { top: calc(10px + var(--safe-top)); }
        .noti-icon { width: 40px; height: 40px; background: #000; color: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; }

        /* === 桌面层 === */
        .desktop-layer {
            position: relative; width: 100%; height: 100%; z-index: 10;
            display: flex; flex-direction: column; padding: 10px 24px 30px;
        }

        /* 1. Profile 卡片 */
        .profile-card {
            margin-bottom: 30px; display: flex; flex-direction: column; align-items: flex-start;
        }
        .profile-avatar-wrap {
            width: 64px; height: 64px; border-radius: 50%; margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05); background: #fff;
        }
        .profile-avatar-wrap img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; }
        .p-name { font-size: 36px; font-weight: 800; line-height: 1.1; margin-bottom: 6px; letter-spacing: -1px; }
        .p-handle { font-size: 15px; color: var(--text-sub); font-weight: 500; }

        /* 2. 中部 Grid */
        .dashboard-grid {
            display: flex; gap: 20px; flex: 1; margin-bottom: 20px;
        }
        
        .widget-column { flex: 1; display: flex; flex-direction: column; gap: 16px; }
        .text-widget {
            flex: 1; background: var(--card-white); border-radius: 24px; padding: 20px;
            display: flex; flex-direction: column; justify-content: space-between;
            box-shadow: var(--shadow);
        }
        .text-widget span { font-size: 16px; font-weight: 700; color: #000; line-height: 1.3; }
        .t-icon { width: 8px; height: 8px; background: #000; border-radius: 50%; }

        /* 右侧 APP Grid */
        .mini-app-grid {
            flex: 1; display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; gap: 16px;
        }
        .app-item {
            background: var(--card-white); border-radius: 24px;
            display: flex; align-items: center; justify-content: center;
            box-shadow: var(--shadow); cursor: pointer; transition: transform 0.1s;
        }
        .app-item:active { transform: scale(0.95); }
        .app-icon { font-size: 26px; color: #000; display: flex; align-items: center; justify-content: center; }

        /* 3. 底部 Dock */
        .dock-container { margin-top: auto; }
        .dock {
            background: var(--card-white); height: 80px; width: 100%;
            border-radius: 40px; display: flex; align-items: center; justify-content: space-around;
            box-shadow: 0 10px 40px rgba(0,0,0,0.08); padding: 0 10px;
        }
        .dock .app-item {
            background: transparent; box-shadow: none; width: 50px; height: 50px;
        }
        .dock .app-icon { font-size: 22px; font-weight: 600; }

        /* === 窗口系统 === */
        .app-window {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #F5F5F7; z-index: 100;
            transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.33, 1, 0.68, 1);
            display: flex; flex-direction: column;
        }
        .app-window.open { transform: translateY(0); }

        .nav-bar {
            height: calc(50px + var(--safe-top)); padding-top: var(--safe-top);
            display: flex; align-items: center; justify-content: space-between; padding-left: 20px; padding-right: 20px;
            background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); z-index: 10;
        }
        .nav-title { font-weight: 700; font-size: 18px; color: #000; }
        .nav-btn { border: none; background: none; font-size: 16px; color: #007AFF; font-weight: 500; }

        .scroll-area { flex: 1; overflow-y: auto; padding: 20px; }

        /* 设置面板样式 */
        .set-group { background: #fff; border-radius: 16px; margin-bottom: 20px; padding: 0 16px; }
        .set-row { display: flex; justify-content: space-between; align-items: center; padding: 16px 0; border-bottom: 1px solid #f0f0f0; }
        .set-row:last-child { border-bottom: none; }
        .set-label { font-size: 16px; font-weight: 500; }
        .set-val { border: none; text-align: right; background: transparent; font-size: 15px; color: #888; width: 60%; }
        
        .btn-action { width: 100%; padding: 15px; border-radius: 12px; border: none; font-weight: 600; margin-bottom: 10px; font-size: 15px; }
        .btn-gray { background: #fff; color: #000; border: 1px solid #ddd; }
        .btn-red { background: #FFE5E5; color: #FF3B30; }

        /* 聊天窗口特化 */
        .chat-view { background: #F5F5F7; z-index: 200; transform: translateX(100%); transition: transform 0.3s ease; position: absolute; top:0; left:0; width:100%; height:100%; display:flex; flex-direction: column; }
        .chat-view.active { transform: translateX(0); }
        
        .im-bubble { background: #fff; color: #000; padding: 12px 16px; border-radius: 18px; max-width: 75%; font-size: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .im-row.user .im-bubble { background: #000; color: #fff; border-radius: 18px; }
        .im-footer { background: #fff; padding-bottom: var(--safe-bottom); padding-top:10px; border-top: 1px solid #eee; }
        .im-input-wrap { background: #f0f0f0; border-radius: 20px; padding: 8px 15px; margin: 0 10px; display:flex; flex:1; }
        .im-input { border:none; background:transparent; width:100%; outline:none; font-size:16px; }
        
        /* 模态框 */
        .modal-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.4); z-index:5000; display:none; align-items:center; justify-content:center; backdrop-filter:blur(5px); }
        .modal-box { background:#fff; width:85%; border-radius:24px; padding:24px; box-shadow:0 20px 60px rgba(0,0,0,0.15); }
        .modal-input { width:100%; background:#f5f5f7; border:none; padding:12px; border-radius:12px; margin-bottom:15px; font-size:15px; }
        .modal-btn { padding:12px; border-radius:12px; border:none; font-weight:600; font-size:15px; }

    </style>
</head>
<body>

<div id="phone-wrapper">
    <!-- 状态栏 -->
    <div class="status-bar">
        <div id="st-time">12:00</div>
        <div style="display:flex; gap:6px; align-items:center;">
            <span>5G</span>
            <div class="battery"><div class="battery-level"></div></div>
        </div>
    </div>

    <!-- 通知弹窗 -->
    <div id="noti-banner" class="noti-banner" onclick="jumpToChat()">
        <div class="noti-icon"><i class="fas fa-comment"></i></div>
        <div style="flex:1;overflow:hidden">
            <div id="noti-n" style="font-weight:700;font-size:15px;color:#000">消息通知</div>
            <div id="noti-t" style="font-size:13px;color:#888;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">内容...</div>
        </div>
    </div>

    <!-- 桌面图层 -->
    <div class="desktop-layer">
        <!-- Profile -->
        <div class="profile-card">
            <div class="profile-avatar-wrap">
                <img src="https://api.dicebear.com/9.x/micah/svg?seed=Moom" alt="Avatar">
            </div>
            <div class="profile-info">
                <div class="p-name">Hello,<br>User.</div>
                <div class="p-handle">Creative Developer</div>
            </div>
        </div>

        <!-- Dashboard -->
        <div class="dashboard-grid">
            <div class="widget-column">
                <div class="text-widget">
                    <div class="t-icon"></div>
                    <span>Stay<br>Focused</span>
                </div>
                <div class="text-widget">
                    <span>Create<br>Magic</span>
                    <div class="t-icon" style="margin-left:auto;background:#ccc!important"></div>
                </div>
            </div>

            <div class="mini-app-grid">
                <div class="app-item" onclick="openApp('win-chat')">
                    <div class="app-icon"><i class="fas fa-comment-dots"></i></div>
                </div>
                <div class="app-item">
                    <div class="app-icon"><i class="fas fa-book"></i></div>
                </div>
                <div class="app-item" onclick="openApp('win-sets')">
                    <div class="app-icon"><i class="fas fa-cog"></i></div>
                </div>
                <div class="app-item">
                    <div class="app-icon"><i class="fas fa-pen-nib"></i></div>
                </div>
            </div>
        </div>

        <!-- Dock -->
        <div class="dock-container">
            <div class="dock">
                <div class="app-item" onclick="openApp('win-sets')">
                    <div class="app-icon" style="font-size:14px;font-weight:800">API</div>
                </div>
                <div class="app-item">
                    <div class="app-icon" style="font-size:16px;font-weight:700">Aa</div>
                </div>
                <div class="app-item">
                    <div class="app-icon"><i class="fas fa-images"></i></div>
                </div>
                <div class="app-item">
                    <div class="app-icon"><i class="fab fa-chrome"></i></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 窗口：设置 -->
    <div class="app-window" id="win-sets">
        <div class="nav-bar">
            <button class="nav-btn" onclick="closeApp('win-sets')">取消</button>
            <div class="nav-title">设置</div>
            <button class="nav-btn" style="color:#000;font-weight:700" onclick="saveGlobalSets()">完成</button>
        </div>
        <div class="scroll-area">
            <div class="set-group">
                <div class="set-row"><span class="set-label">API 地址</span><input type="text" class="set-val" id="set-url" placeholder="https://..."></div>
                <div class="set-row"><span class="set-label">API Key</span><input type="password" class="set-val" id="set-key" placeholder="sk-..."></div>
                <div class="set-row"><span class="set-label">模型</span><input type="text" class="set-val" id="set-model"></div>
            </div>
            <button onclick="localStorage.clear(); location.reload();" class="btn-action btn-red">重置数据</button>
        </div>
    </div>

    <!-- 窗口：会话 -->
    <div class="app-window" id="win-chat">
        <div class="nav-bar">
            <button class="nav-btn" onclick="closeApp('win-chat')">返回</button>
            <div class="nav-title">消息</div>
            <button class="nav-btn" onclick="openModal('create')" style="font-size:20px;color:#000">+</button>
        </div>
        <div class="scroll-area" id="list-con" style="padding:10px 20px;">
            <!-- JS填充列表 -->
        </div>
    </div>

    <!-- 详情页 -->
    <div class="chat-view" id="win-room">
        <div class="nav-bar">
            <button class="nav-btn" onclick="exitRoom()">❮ 返回</button>
            <div id="room-n" class="nav-title">Name</div>
            <button class="nav-btn" onclick="openModal('edit')" style="color:#000">•••</button>
        </div>
        <div class="scroll-area" id="im-scroll">
            <div id="im-inject" style="display:flex;flex-direction:column;gap:15px;padding-bottom:20px;"></div>
        </div>
        <div class="im-footer">
            <div style="display:flex;align-items:center;padding:0 10px;">
                <div class="im-input-wrap">
                    <input type="text" id="chat-inp" class="im-input" placeholder="输入消息..." onkeypress="if(event.key==='Enter')handleSend()">
                </div>
                <button onclick="handleSend()" style="border:none;background:#000;color:#fff;width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;"><i class="fas fa-arrow-up"></i></button>
            </div>
        </div>
    </div>

    <!-- 角色配置弹窗 -->
    <div class="modal-overlay" id="mo-overlay">
        <div class="modal-box">
            <h3 style="text-align:center;margin-bottom:20px;">新角色</h3>
            <input type="text" id="mo-n" class="modal-input" placeholder="名字">
            <textarea id="mo-p" class="modal-input" style="height:100px;resize:none" placeholder="设定..."></textarea>
            <div style="display:flex;gap:10px;">
                <button onclick="hideModal()" class="modal-btn" style="background:#eee;color:#000">取消</button>
                <button onclick="commitModal()" class="modal-btn" style="background:#000;color:#fff;flex:1">保存</button>
            </div>
        </div>
    </div>

    <!-- 引入JS -->
    <script src="script.js"></script>
    
    <!-- 必要的补充脚本方法 -->
    <script>
    function openApp(id) {
        document.getElementById(id).classList.add('open');
    }
    function closeApp(id) {
        document.getElementById(id).classList.remove('open');
    }
    document_api_memory_tool = {
        create_memory: () => {}, edit_memory: () => {}, delete_memory: () => {}
    }; // Mock memory tool to prevent errors
    </script>
</div>
</body>
</html>